sudo: required
language: java
jdk: openjdk8

services:
  - mongodb
  - docker

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - .gradle/
    - node_modules/

before_install:
  - chmod +x gradlew

script:
  - ./gradlew clean buildImage

after_success:
  - if [ ! -z "$TRAVIS_TAG" ]; then
      docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
      docker push zhudyos/duic;
    fi

deploy:
  provider: releases
  api_key: "V/U4vCH3tpBLmmAwGrzCsXUjRr7PpzJ5ywQgC2b5UQAwC5UVkxUchSEHBW2ZnqpphHuqnB0r8X6DbRsyGLXraed6Pac6yeePg3CbQ4kwVNwShZpMnVOK0kBekj9KnnzWKqPdgBPfiZu0wdy1szey6bMSZaYhuNKP4SkDNjaMBXw1WtZKQhupz65VQPSZtBqRqZ9AamRiA54+UA8TK5gE24D7l6HQaqbnUbNGPAS7hRkmYab+9f4sRiAdD0QIP0Mke6I0GwTHK2GP6o8DAqDljeamyMtSZ1NoYtQ5oGXBeKDKlc+LVUN/LsrlByJqN4Zlfrrq7HG5falbq+FKiBK+NT5au+daQl1mO2QyDQpPzqFHH2GcqZMatJ5L70/iIkaZ1b/jCBnBD+f+qj3E4eslvpR05wS/UtAavGdFK+VkDsF4yAA4w+GPK96pKQcxg6qtPajrvdbLAZptAKQ5F5k2GPerr5HvbkeMl3p8C+DtK5Rq2WXe0gsnWhV6XZJQPOYWLz9RIjWMe8NdOZIg1IGoHzCOZCrgyPksI9mfWrgm9+lmh2gU1hxRJiSII+rLWUuEp5xLIgvnkxmLbtS2x968LGEUQnVj0D/bCCF4eiwAsm4NKlLTo3rNiOEOQ/H3BXUtioadrv53uhV2+0xlLnKxDeox1R0FpXe91EqDjMUCj58="
  file:
    - /build/libs/duic-$TRAVIS_TAG.jar
  on:
    tags: true
